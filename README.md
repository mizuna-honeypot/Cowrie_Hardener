# Cowrie Hardener ğŸ›¡ï¸

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.x](https://img.shields.io/badge/python-3.x-blue.svg)](https://www.python.org/downloads/)

Cowrieãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã®ã€ŒæŒ‡ç´‹ï¼ˆãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆï¼‰ã€ã‚’è‡ªå‹•çš„ã«æ¶ˆå»ã—ã€æ¤œçŸ¥ã‚’å›é¿ã™ã‚‹ãŸã‚ã®å …ç‰¢åŒ–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

---
## æ¦‚è¦

Cowrieã¯éå¸¸ã«å„ªã‚ŒãŸSSHãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã§ã™ãŒã€ãã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¯åºƒãçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€æ”»æ’ƒè€…ã‚„ç ”ç©¶è€…ã¯ã€Cowrieç‰¹æœ‰ã®è¨­å®šï¼ˆã€ŒæŒ‡ç´‹ã€ï¼‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã“ã¨ã§ã€ãã‚ŒãŒæœ¬ç‰©ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ãªããƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã§ã‚ã‚‹ã“ã¨ã‚’è¦‹æŠœã„ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã®`cowrie_hardener.py`ã¯ã€ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ¤œçŸ¥ãƒ„ãƒ¼ãƒ«ã¨ã®**ã€Œã„ãŸã¡ã”ã£ã“ï¼ˆCat and Mouse Gameï¼‰ã€**ã«å‹åˆ©ã™ã‚‹ãŸã‚ã«é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¸€åº¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã€Cowrieã®æ—¢çŸ¥ã®å¼±ç‚¹ã‚’è‡ªå‹•çš„ã«ä¿®æ­£ã—ã€ã‚ãªãŸã®ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚’æœ¬ç‰©ã®ã‚µãƒ¼ãƒãƒ¼ã®ã‚ˆã†ã«å½è£…ã—ã¾ã™ã€‚

---
## ä¸»ãªæ©Ÿèƒ½

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ä»¥ä¸‹ã®é …ç›®ã‚’è‡ªå‹•ã§å …ç‰¢åŒ–ï¼ˆãƒãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°ï¼‰ã—ã¾ã™ã€‚

* âœ… **SSHãƒãƒŠãƒ¼ã®ãƒ©ãƒ³ãƒ€ãƒ åŒ–**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®SSHãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã‚’ã€ã‚ˆã‚Šä¸€èˆ¬çš„ã§ç¾å®Ÿçš„ãªã‚‚ã®ã«ç½®ãæ›ãˆã¾ã™ã€‚
* âœ… **ãƒ›ã‚¹ãƒˆåã®ãƒ©ãƒ³ãƒ€ãƒ åŒ–**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ›ã‚¹ãƒˆåï¼ˆ`svr04`ãªã©ï¼‰ã‚’ã€`web112.internal`ã®ã‚ˆã†ãªãƒ©ãƒ³ãƒ€ãƒ ãªåå‰ã«å¤‰æ›´ã—ã¾ã™ã€‚
* âœ… **ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å½è£…**: æ—¢çŸ¥ã®å¤ã„ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã€ã‚ˆã‚Šãƒ¢ãƒ€ãƒ³ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã«å½è£…ã—ã¾ã™ã€‚
* âœ… **å¼±ã„èªè¨¼æƒ…å ±ã®æ’é™¤**: `phil:phil`ã‚„`admin:admin`ã®ã‚ˆã†ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’`userdb.txt`ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚
* âœ… **`root`ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¼·åŒ–**: `root`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ®‹ã—ã¤ã¤ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã«è¨­å®šã—ã¾ã™ã€‚
* âœ… **éš ã—è¨­å®šã®ç„¡åŠ¹åŒ–**: `root:root`ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¦ã—ã¾ã†ç‰¹æ®Šãªè¨­å®šï¼ˆ`accept_root_password`ï¼‰ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚
* âœ… **ãƒ—ãƒ­ã‚­ã‚·èªè¨¼æƒ…å ±ã®ç„¡åŠ¹åŒ–**: åˆ¥ã®èªè¨¼çµŒè·¯ã§ã‚ã‚‹ãƒ—ãƒ­ã‚­ã‚·ç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèªè¨¼æƒ…å ±ã‚’ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã—ã¾ã™ã€‚
* âœ… **å½ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€è²«æ€§ç¶­æŒ**: å½ã®`/etc/passwd`ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç—•è·¡ã‚’æ¶ˆå»ã—ã¾ã™ã€‚

---
## å¿…è¦ãªã‚‚ã®

* Python 3.x
* Cowrieãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã®ç¨¼åƒç’°å¢ƒ

---
## ä½¿ã„æ–¹

**âš ï¸ è­¦å‘Š: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥æ›¸ãæ›ãˆã¾ã™ã€‚å®Ÿè¡Œå‰ã«å¿…ãš`etc`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚**

1.  **ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã¾ãŸã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚**
    ```bash
    git clone https://github.com/mizuna-honeypot/cowrie_hardener.git
    cd cowrie_hardener
    ```

2.  **ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®ãƒ‘ã‚¹ã‚’ç·¨é›†ã—ã¾ã™ã€‚**
    `cowrie_hardener.py`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€å†’é ­ã«ã‚ã‚‹`COWRIE_ETC_PATH`ã®å€¤ã‚’ã€ã‚ãªãŸã®ç’°å¢ƒã®Cowrieã®`etc`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çµ¶å¯¾ãƒ‘ã‚¹ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
    ```python
    # ä¾‹: CowrieãŒ/opt/cowrie/ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆ
    COWRIE_ETC_PATH = '/opt/cowrie/etc/'
    ```

3.  **ç®¡ç†è€…æ¨©é™ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚**
    ```bash
    sudo python3 cowrie_hardener.py
    ```

4.  **Cowrieã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚**
    **ã€æœ€é‡è¦ã€‘** å¤‰æ›´ã‚’é©ç”¨ã™ã‚‹ã«ã¯ã€å¿…ãšCowrieã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
    ```bash
    # Systemdã®å ´åˆ
    sudo systemctl restart cowrie

    # ã¾ãŸã¯ã€Cowrieã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç›´æ¥å®Ÿè¡Œã™ã‚‹å ´åˆ
    # /path/to/your/cowrie/bin/cowrie restart
    ```
---
## è²¢çŒ® (Contributing)

ãƒã‚°å ±å‘Šã€æ©Ÿèƒ½è¿½åŠ ã®ææ¡ˆã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã©ã‚’æ­“è¿ã—ã¾ã™ã€‚

---
## æ³¨æ„äº‹é …

* ã“ã®ãƒ„ãƒ¼ãƒ«ã¯è‡ªå·±è²¬ä»»ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚ä½œè€…ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
* å®Ÿè¡Œå‰ã«å¿…ãšè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚

---
## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯[MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹](LICENSE)ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

# Cowrie Hardener ğŸ›¡ï¸

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.x](https://img.shields.io/badge/python-3.x-blue.svg)](https://www.python.org/downloads/)

An automated hardening script to erase the fingerprints of your Cowrie honeypot and evade detection.

---
## Overview

Cowrie is an excellent SSH honeypot, but its default settings are widely known. Attackers and researchers can easily identify a server as a honeypot by scanning for these Cowrie-specific "fingerprints."

`cowrie_hardener.py` was developed to win the **cat-and-mouse game** against honeypot detection tools. By running this script just once, you can automatically patch Cowrie's known weaknesses and disguise your honeypot as a legitimate server.

---
## Key Features

This tool automatically hardens the following items:

* âœ… **Randomizes SSH Banner**: Replaces the default SSH version string with a more common and realistic one.
* âœ… **Randomizes Hostname**: Changes the default hostname (e.g., `svr04`) to a random name like `web112.internal`.
* âœ… **Spoofs Kernel Version**: Disguises the known, outdated kernel version with a more modern version string.
* âœ… **Eliminates Weak Credentials**: Completely removes default users like `phil:phil` and `admin:admin` from `userdb.txt`.
* âœ… **Strengthens Root Password**: Keeps the `root` user but sets its password to a strong, random string.
* âœ… **Disables Backdoor Login**: Disables the special setting (`accept_root_password`) that allows login with `root:root`.
* âœ… **Neutralizes Proxy Credentials**: Randomizes the default credentials for the separate proxy authentication path.
* âœ… **Maintains Filesystem Consistency**: Erases traces of default users from the fake `/etc/passwd` file.

---
## Prerequisites

* Python 3.x
* A running Cowrie honeypot environment.

---
## Usage

**âš ï¸ WARNING: This script directly modifies system configuration files. Always create a backup of your entire `etc` directory before running it.**

1.  **Clone the repository or download the script.**
    ```bash
    git clone https://github.com/mizuna-honeypot/cowrie_hardener.git
    cd cowrie_hardener
    ```

2.  **Edit the path in the script.**
    Open the `cowrie_hardener.py` file and modify the `COWRIE_ETC_PATH` variable at the top to the absolute path of your Cowrie's `etc` directory.
    ```python
    # Example: If Cowrie is installed in /opt/cowrie/
    COWRIE_ETC_PATH = '/opt/cowrie/etc/'
    ```

3.  **Run the script with administrative privileges.**
    ```bash
    sudo python3 cowrie_hardener.py
    ```

4.  **Restart the Cowrie service.**
    **ã€CRITICALã€‘** You must restart Cowrie to apply the changes.
    ```bash
    # If using systemd
    sudo systemctl restart cowrie

    # Or, if running directly with Cowrie's scripts
    # /path/to/your/cowrie/bin/cowrie restart
    ```

---
## Contributing

Bug reports, feature requests, and pull requests are welcome.

---
## Disclaimer

* Use this tool at your own risk. The author is not responsible for any damage.
* It is strongly recommended to back up your configuration files before execution.

---
## License

This project is licensed under the [MIT License](LICENSE).
